<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ParkSense - 智能公园导航系统</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🗺️</text></svg>">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif; height:100vh; overflow:hidden; }
    #map { width:100%; height:100%; }
    .floating-btn {
      position:fixed; bottom:20px; right:20px; z-index:1000;
      width:56px; height:56px; border-radius:50%; background:#0ea5e9; color:#fff;
      border:none; cursor:pointer; box-shadow:0 4px 12px rgba(0,0,0,0.15);
      display:flex; align-items:center; justify-content:center; font-size:20px;
    }
    .floating-btn:hover { background:#0284c7; }
    .sidebar {
      position:fixed; top:0; right:-400px; width:400px; height:100vh; background:#fff;
      box-shadow:-2px 0 10px rgba(0,0,0,0.1); transition:right 0.3s ease; z-index:999;
      display:flex; flex-direction:column; overflow-y:auto;
    }
    .sidebar.open { right:0; }
    .sidebar header {
      background:#f8fafc;
      padding:16px; border-bottom:1px solid #e2e8f0; flex-shrink:0;
      display:flex; justify-content:space-between; align-items:center;
    }
    .title { font-weight:700; color:#155e75; font-size:18px; }
    .close-btn { background:none; border:none; font-size:24px; cursor:pointer; color:#64748b; }
    .content { padding:16px; flex:1; overflow-y:auto;
      display:flex; flex-direction:column; gap:8px;
    }
    .section-title { font-weight:600; font-size:14px; margin-bottom:6px; }
    .btn { padding:8px 12px; background:#f1f5f9; border:1px solid #cbd5e1;
      border-radius:6px; cursor:pointer; font-size:13px; flex-shrink:0;
    }
    .btn.primary { background:#0ea5e9; color:#fff; }
    .btn:hover { background:#e2e8f0; }
    .btn.primary:hover { background:#0284c7; }
    .layer-list { display:flex; flex-direction:column; gap:4px;
      max-height:200px; overflow-y:auto;
    }
    .layer-item {
      display:flex; justify-content:space-between; align-items:center; padding:6px 8px;
      background:#f8fafc; border:1px solid #e2e8f0; border-radius:4px;
      font-size:13px;
    }
    .layer-name { font-weight:500; color:#334155; }
    .layer-state { font-size:11px; padding:2px 6px; border-radius:3px; }
    .layer-state.ok { background:#dcfce7; color:#166534; }
    .layer-state.loading { background:#fef3c7; color:#92400e; }
    .layer-state.err { background:#fecaca; color:#991b1b; }
    .controls { display:flex; flex-direction:column; gap:8px;
      border-bottom:1px solid #f2f2f2;
    }
    .hint { font-size:12px; color:#334155; background:#f1f5f9; padding:8px; border-radius:6px; }
    .poi-controls { display:flex; flex-direction:column; gap:8px; }
    .control-row { display:flex; align-items:center; gap:8px; }
    .control-row label { font-size:13px; min-width:60px; }
    .control-row input[type="range"] { flex:1; }
    .control-row span { font-size:12px; color:#64748b; min-width:30px; }
    .poi-types { display:grid; grid-template-columns:1fr 1fr; gap:4px; max-height:200px; overflow-y:auto; }
    .poi-type { display:flex; align-items:center; gap:4px; font-size:12px; }
    .poi-buttons { display:flex; gap:4px; }
    .poi-buttons button { flex:1; padding:4px 8px; font-size:11px; }
    .analysis { font-size:12px; background:#f8fafc; padding:8px; border-radius:4px; margin-top:8px; }
    .pick-hint { position:fixed; top:20px; left:50%; transform:translateX(-50%); 
      background:#fbbf24; color:#92400e; padding:8px 16px; border-radius:6px; 
      font-size:14px; z-index:1000; display:none; }
    .layer-toggles { display:flex; flex-direction:column; gap:4px; }
    .layer-toggle { display:flex; align-items:center; gap:6px; font-size:13px; cursor:pointer; }
    .layer-toggle input[type="checkbox"] { margin:0; }
  .chip { display:inline-flex; align-items:center; padding:4px 10px; border-radius:16px; background:#f1f5f9; border:1px solid #cbd5e1; cursor:pointer; font-size:12px; color:#334155; }
  .chip.selected { background:#4CAF50; border-color:#4CAF50; color:#fff; }
  .rec-card { background:#F8F9FA; border-left:4px solid #4CAF50; border-radius:8px; padding:12px; margin:8px 0; cursor:pointer; }
  .rec-card.secondary { border-left-color:#81C784; }
  .rec-card.selected { outline:2px solid #0ea5e9; }
  </style>
</head>
<body>
  <div id="map"></div>
  
  <button class="floating-btn" onclick="toggleSidebar()">⚙</button>
  
  <div class="sidebar" id="sidebar">
    <header>
      <div class="title">图层控制</div>
      <button class="close-btn" onclick="toggleSidebar()">×</button>
    </header>
    <div class="content">
      <div class="section-title">条件筛选</div>
      <div id="filterChips" style="display:flex; flex-wrap:wrap; gap:6px; margin-bottom:8px;">
        <span class="chip" data-filter="atmosphere" data-value="quiet">安静</span>
        <span class="chip" data-filter="atmosphere" data-value="shaded">遮阴</span>
        <span class="chip" data-filter="atmosphere" data-value="scenic">景观</span>
        <span class="chip" data-filter="wildlife" data-value="birds">野生动物</span>
        <span class="chip" data-filter="duration" data-value="15">15分钟</span>
        <span class="chip" data-filter="duration" data-value="30">30分钟</span>
      </div>
      <div class="section-title">智能推荐</div>
      <div id="recResults" class="analysis">请选择筛选条件以生成推荐路线</div>
      <button class="btn primary" id="applyRec" disabled>应用推荐路线</button>

      <div class="section-title">数据图层 <span id="layerStatus">0/6</span></div>
      <div class="layer-list" id="layerList"></div>
      
      <button class="btn primary" onclick="autoLoadAll()">自动加载全部</button>
      
      <div class="section-title">图层开关</div>
      <div class="layer-toggles">
        <label class="layer-toggle">
          <input type="checkbox" data-layer="boundary"> 公园边界
        </label>
        <label class="layer-toggle">
          <input type="checkbox" data-layer="trails" checked> 步道网络
        </label>
        <label class="layer-toggle">
          <input type="checkbox" data-layer="vegetation"> 植被
        </label>
        <label class="layer-toggle">
          <input type="checkbox" data-layer="water"> 水景
        </label>
        <label class="layer-toggle">
          <input type="checkbox" data-layer="facilities"> 设施
        </label>
        <label class="layer-toggle">
          <input type="checkbox" data-layer="poi" checked> 兴趣点
        </label>
      </div>
      
      <div class="section-title">POI控制</div>
      <div class="poi-controls">
        <div class="control-row">
          <label>大小:</label>
          <input type="range" id="poiSize" min="2" max="10" value="4">
          <span id="poiSizeValue">4</span>
        </div>
        <div class="control-row">
          <label>透明度:</label>
          <input type="range" id="poiOpacity" min="0.1" max="1" step="0.1" value="0.8">
          <span id="poiOpacityValue">0.8</span>
        </div>
        <div class="control-row">
          <label>数量限制:</label>
          <input type="range" id="poiLimit" min="50" max="1000" step="50" value="1000">
          <span id="poiLimitValue">1000</span>
        </div>
        <div class="control-row">
          <label>地理过滤:</label>
          <select id="poiFilter">
            <option value="none">无</option>
            <option value="ultra-strict">极严格</option>
            <option value="strict">严格</option>
            <option value="moderate">中等</option>
            <option value="loose" selected>宽松</option>
          </select>
        </div>
        
        <div class="section-title">POI类型选择</div>
        <div class="poi-buttons">
          <button class="btn" id="selectAllPoi">全选</button>
          <button class="btn" id="selectNonePoi">全不选</button>
          <button class="btn" id="selectEssentialPoi">基础设施</button>
        </div>
        
        <div class="poi-types">
          <label class="poi-type"><input type="checkbox" id="poi-toilets"> 洗手间</label>
          <label class="poi-type"><input type="checkbox" id="poi-food"> 餐饮</label>
          <label class="poi-type"><input type="checkbox" id="poi-entrance"> 入口</label>
          <label class="poi-type"><input type="checkbox" id="poi-information"> 信息</label>
          <label class="poi-type"><input type="checkbox" id="poi-playground"> 游乐场</label>
          <label class="poi-type"><input type="checkbox" id="poi-bench"> 长椅</label>
          <label class="poi-type"><input type="checkbox" id="poi-water"> 饮水</label>
          <label class="poi-type"><input type="checkbox" id="poi-parking"> 停车</label>
          <label class="poi-type"><input type="checkbox" id="poi-shop"> 商店</label>
          <label class="poi-type"><input type="checkbox" id="poi-garden"> 花园</label>
          <label class="poi-type"><input type="checkbox" id="poi-trees" checked> 树木</label>
          <label class="poi-type"><input type="checkbox" id="poi-wildlife" checked> 野生动物</label>
          <label class="poi-type"><input type="checkbox" id="poi-water-feature"> 水景</label>
          <label class="poi-type"><input type="checkbox" id="poi-memorial"> 纪念碑</label>
          <label class="poi-type"><input type="checkbox" id="poi-bridge"> 桥梁</label>
          <label class="poi-type"><input type="checkbox" id="poi-viewpoint"> 观景点</label>
          <label class="poi-type"><input type="checkbox" id="poi-art"> 艺术品</label>
          <label class="poi-type"><input type="checkbox" id="poi-monument"> 雕塑</label>
          <label class="poi-type"><input type="checkbox" id="poi-other"> 其他</label>
        </div>
        
        <button class="btn primary" id="reloadPoi">重新加载POI</button>
        <button class="btn" id="analyzePoi">分析POI数据</button>
        <div class="analysis" id="poiAnalysis">点击分析查看POI统计</div>
      </div>
      
      <div class="section-title">路径规划</div>
      <div class="controls">
        <button class="btn" id="pickStart">选择起点</button>
        <button class="btn" id="pickEnd">选择终点</button>
        <button class="btn primary" id="plan" disabled>规划路径</button>
        <button class="btn" id="clear">清除</button>
        <div id="statDistance">总距离: —</div>
        <div id="statTime">预计时间: —</div>
        <div id="weather">天气: 获取中...</div>
      </div>
    </div>
  </div>
  
  <div class="pick-hint" id="pickHint"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="./js/app.js"></script>
  <script>
    // 添加toggleSidebar到全局作用域，以便HTML onclick可以调用
    window.toggleSidebar = toggleSidebar;
    window.autoLoadAll = autoLoadAll;
  </script>
</body>
</html>
